{"version":3,"file":"connection-plugin.esm.js","sources":["../src/utils.ts","../src/picker/view.ts","../src/picker/index.ts","../src/flow.ts","../src/index.ts"],"sourcesContent":["import { Emitter, Connection } from 'rete';\r\nimport { EventsTypes } from 'rete/types/events';\r\n\r\nfunction toTrainCase(str: string) {\r\n    return str.toLowerCase().replace(/ /g, '-');\r\n}\r\n\r\nexport function getMapItemRecursively<T extends any>(map: WeakMap<Element, T>, el: Element): T | null {\r\n    return map.get(el) || (el.parentElement ? getMapItemRecursively(map, el.parentElement) : null);\r\n}\r\n\r\nexport function defaultPath(points: number[], curvature: number) {\r\n    const [x1, y1, x2, y2] = points;\r\n    const hx1 = x1 + Math.abs(x2 - x1) * curvature;\r\n    const hx2 = x2 - Math.abs(x2 - x1) * curvature;\r\n\r\n    return `M ${x1} ${y1} C ${hx1} ${y1} ${hx2} ${y2} ${x2} ${y2}`;\r\n}\r\n\r\nexport function renderPathData(emitter: Emitter<EventsTypes>, points: number[], connection?: Connection) {\r\n    const data = { points, connection, d: '' };\r\n    \r\n    emitter.trigger('connectionpath', data);\r\n    \r\n    return data.d || defaultPath(points, 0.4);\r\n}\r\n\r\nexport function updateConnection({ el, d } : { el: HTMLElement, d: string }) {\r\n    const path = el.querySelector('.connection path');\r\n\r\n    if (!path) throw new Error('Path of connection was broken');\r\n\r\n    path.setAttribute('d', d);\r\n}\r\n\r\nexport function renderConnection({ el, d, connection } : { el: HTMLElement, d: string, connection?: Connection }) {\r\n    const classed = !connection?[]:[\r\n        'input-' + toTrainCase(connection.input.name),\r\n        'output-' + toTrainCase(connection.output.name),\r\n        'socket-input-' + toTrainCase(connection.input.socket.name),\r\n        'socket-output-' + toTrainCase(connection.output.socket.name)\r\n    ];\r\n\r\n    const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg')\r\n    const path = document.createElementNS('http://www.w3.org/2000/svg', 'path')\r\n\r\n    svg.classList.add('connection', ...classed);\r\n    path.classList.add('main-path');\r\n    path.setAttribute('d', d);\r\n\r\n    svg.appendChild(path);\r\n    el.appendChild(svg);\r\n\r\n    updateConnection({ el, d });\r\n}","import { Output, Input, Emitter } from 'rete';\r\nimport { EditorView } from 'rete/types/view/index';\r\nimport { EventsTypes } from 'rete/types/events';\r\nimport { renderConnection, renderPathData, updateConnection } from '../utils';\r\n\r\nexport class PickerView {\r\n\r\n    private el: HTMLElement;\r\n\r\n    constructor(\r\n        private emitter: Emitter<EventsTypes>,\r\n        private editorView: EditorView\r\n    ) {\r\n        this.el = document.createElement('div');\r\n        this.el.style.position = 'absolute';\r\n        this.editorView.area.appendChild(this.el);\r\n    }\r\n\r\n    updatePseudoConnection(io: Output | Input | null) {\r\n        if (io !== null) {\r\n            this.renderConnection(io);\r\n        } else if (this.el.parentElement) {\r\n            this.el.innerHTML = '';\r\n        }\r\n    }\r\n\r\n    private getPoints(io: Output | Input): number[] {\r\n        const mouse = this.editorView.area.mouse;\r\n\r\n        if(!io.node) throw new Error('Node in output/input not found')\r\n    \r\n        const node = this.editorView.nodes.get(io.node);\r\n\r\n        if(!node) throw new Error('Node view not found')\r\n    \r\n        const [x1, y1] = node.getSocketPosition(io);\r\n\r\n        return io instanceof Output\r\n            ? [x1, y1, mouse.x, mouse.y]\r\n            : [mouse.x, mouse.y, x1, y1];\r\n    }\r\n\r\n    updateConnection(io: Output | Input) {\r\n        const d = renderPathData(this.emitter, this.getPoints(io));\r\n\r\n        updateConnection({ el: this.el, d });\r\n    }\r\n\r\n    renderConnection(io: Output | Input) {\r\n        const d = renderPathData(this.emitter, this.getPoints(io));\r\n\r\n        renderConnection({ el: this.el, d });\r\n    }\r\n}","import { NodeEditor, Input, Output, Connection } from 'rete';\r\nimport { PickerView } from './view';\r\n\r\nexport class Picker {\r\n\r\n    private editor: NodeEditor;\r\n    private _io: Output | Input | null = null;\r\n    public view: PickerView;\r\n\r\n    constructor(editor: NodeEditor) {\r\n        this.editor = editor;\r\n        this.view = new PickerView(editor, editor.view);\r\n\r\n        editor.on('mousemove', () => this.io && this.view.updateConnection(this.io));\r\n    }\r\n\r\n    get io() : Output | Input | null {\r\n        return this._io;\r\n    }\r\n\r\n    set io(io: Output | Input | null) {\r\n        this._io = io;\r\n        this.view.updatePseudoConnection(io);\r\n    }\r\n\r\n    reset() {\r\n        this.io = null;\r\n    }\r\n\r\n    pickOutput(output: Output) {\r\n        if (!this.editor.trigger('connectionpick', output)) return;\r\n        \r\n        if (this.io instanceof Input) {\r\n            if(!output.multipleConnections && output.hasConnection())\r\n                this.editor.removeConnection(output.connections[0])\r\n    \r\n            this.editor.connect(output, this.io);\r\n            this.reset();\r\n            return;\r\n        }\r\n\r\n        if (this.io) this.reset();\r\n        this.io = output;\r\n    }\r\n\r\n    pickInput(input: Input) {\r\n        if (!this.editor.trigger('connectionpick', input)) return;\r\n\r\n        if (this.io === null) {\r\n            if (input.hasConnection()) {\r\n                this.io = input.connections[0].output;\r\n                this.editor.removeConnection(input.connections[0]);\r\n            } else {\r\n                this.io = input;\r\n            }\r\n            return true;\r\n        }\r\n\r\n        if (!input.multipleConnections && input.hasConnection())\r\n            this.editor.removeConnection(input.connections[0]);\r\n        \r\n        if (!this.io.multipleConnections && this.io.hasConnection())\r\n            this.editor.removeConnection(this.io.connections[0]);\r\n        \r\n        if (this.io instanceof Output && this.io.connectedTo(input)) {\r\n            let connection = input.connections.find(c => c.output === this.io);\r\n\r\n            if(connection) {\r\n                this.editor.removeConnection(connection);\r\n            }\r\n        }\r\n\r\n        if(this.io instanceof Output) {\r\n            this.editor.connect(this.io, input);\r\n            this.reset();\r\n        }\r\n    }\r\n\r\n    pickConnection(connection: Connection) {\r\n        const { output } = connection;\r\n\r\n        this.editor.removeConnection(connection);\r\n        this.io = output;\r\n    }\r\n}","import { IO, Input, Output } from 'rete';\r\nimport { Picker } from './picker';\r\n\r\nexport type FlowParams = { input?: Input, output?: Output };\r\n\r\nexport class Flow {\r\n\r\n    private picker: Picker;\r\n    private target?: IO | null;\r\n\r\n    constructor(picker: Picker) {\r\n        this.picker = picker;\r\n        this.target = null;\r\n    }\r\n\r\n    private act({ input, output }: FlowParams) {\r\n        if (this.unlock(input || output)) return\r\n\r\n        if (input)\r\n            this.picker.pickInput(input)\r\n        else if (output)\r\n            this.picker.pickOutput(output)\r\n        else\r\n            this.picker.reset();\r\n    }\r\n\r\n    public start(params: FlowParams, io?: IO) {\r\n        this.act(params);\r\n        this.target = io;\r\n    }\r\n\r\n    public complete(params: FlowParams = {}) {\r\n        this.act(params);\r\n    }\r\n\r\n    public hasTarget() {\r\n        return Boolean(this.target);\r\n    }\r\n\r\n    private unlock(io?: IO) {\r\n        const target = this.target;\r\n\r\n        this.target = null;\r\n\r\n        return target && target === io;\r\n    }\r\n}","import { NodeEditor } from 'rete';\r\nimport { renderConnection, renderPathData, updateConnection, getMapItemRecursively } from './utils';\r\nimport { Picker } from './picker';\r\nimport { Flow, FlowParams } from './flow';\r\nimport './events';\r\nimport './index.sass';\r\n\r\nfunction install(editor: NodeEditor) {\r\n    editor.bind('connectionpath');\r\n    editor.bind('connectiondrop');\r\n    editor.bind('_connectiondrop');\r\n    editor.bind('connectionpick');\r\n    editor.bind('resetconnection');\r\n    \r\n    const picker = new Picker(editor);\r\n    const flow = new Flow(picker);\r\n    const socketsParams = new WeakMap<Element, FlowParams>();\r\n    \r\n    function pointerDown(this: HTMLElement, e: PointerEvent) {\r\n        const flowParams = socketsParams.get(this);\r\n\r\n        if(flowParams) {\r\n            const { input, output } = flowParams;\r\n            \r\n            editor.view.container.dispatchEvent(new PointerEvent('pointermove', e));\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n            flow.start({ input, output }, input || output);\r\n        }\r\n    }\r\n\r\n    function pointerUp(this: Window, e: PointerEvent) {\r\n        const flowEl = document.elementFromPoint(e.clientX, e.clientY);\r\n\r\n        if(picker.io) {\r\n            editor.trigger('connectiondrop', picker.io);\r\n            editor.trigger('_connectiondrop', flowEl);\r\n        }\r\n        if(flowEl) {\r\n            flow.complete(getMapItemRecursively(socketsParams, flowEl) || {})\r\n        }\r\n    }\r\n\r\n    editor.on('resetconnection', () => flow.complete());\r\n\r\n    editor.on('rendersocket', ({ el, input, output }) => {\r\n        socketsParams.set(el, { input, output });\r\n\r\n        el.removeEventListener('pointerdown', pointerDown);\r\n        el.addEventListener('pointerdown', pointerDown);\r\n    });\r\n\r\n    window.addEventListener('pointerup', pointerUp);\r\n\r\n    editor.on('renderconnection', ({ el, connection, points }) => {\r\n        const d = renderPathData(editor, points, connection);\r\n\r\n        renderConnection({ el, d, connection })\r\n    });\r\n\r\n    editor.on('updateconnection', ({ el, connection, points }) => {\r\n        const d = renderPathData(editor, points, connection);\r\n\r\n        updateConnection({ el, d });\r\n    });\r\n\r\n    editor.on('destroy', () => {\r\n        window.removeEventListener('pointerup', pointerUp);\r\n    });\r\n}\r\n\r\nexport default {\r\n    name: 'connection',\r\n    install\r\n}\r\nexport { defaultPath } from './utils';"],"names":["toTrainCase","str","toLowerCase","replace","getMapItemRecursively","map","el","get","parentElement","defaultPath","points","curvature","x1","y1","x2","y2","hx1","Math","abs","hx2","renderPathData","emitter","connection","data","d","trigger","updateConnection","path","querySelector","Error","setAttribute","renderConnection","classed","input","name","output","socket","svg","document","createElementNS","classList","add","appendChild","PickerView","editorView","createElement","style","position","area","io","innerHTML","mouse","node","nodes","getSocketPosition","Output","x","y","getPoints","Picker","editor","view","on","Input","multipleConnections","hasConnection","removeConnection","connections","connect","reset","connectedTo","find","c","_io","updatePseudoConnection","Flow","picker","target","unlock","pickInput","pickOutput","params","act","Boolean","install","bind","flow","socketsParams","WeakMap","pointerDown","e","flowParams","container","dispatchEvent","PointerEvent","preventDefault","stopPropagation","start","pointerUp","flowEl","elementFromPoint","clientX","clientY","complete","set","removeEventListener","addEventListener","window"],"mappings":"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"}